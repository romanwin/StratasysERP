CREATE OR REPLACE PACKAGE BODY xxoks_cover AS
  --------------------------------------------------------------------
  --  name:            xxoks_cover
  --  create by:       yuval tal
  --  Revision:        1.0
  --  creation date:   4.4.11
  --------------------------------------------------------------------
  --  purpose :      
  --------------------------------------------------------------------
  --  ver    date        name              desc
  --  1.0    4.4.11      yuval tal         initial build
  --  1.1    30.4.12     yuval tal          modify cursors c_sp_lines c_foc_lines : add date resriction
  --                                        accorsing to contract dates
  --------------------------------------------------------------------
  CURSOR c_sp_lines(c_incident_id        NUMBER,
                    c_from_contract_date DATE,
                    c_to_contract_date   DATE) IS
    SELECT ced.inventory_item_id,
           --    t.incident_number,
           ced.incident_id,
           ced.selling_price,
           ced.estimate_detail_id,
           ced.activity_start_date_time,
           ced.list_price,
           ced.contract_discount_amount,
           ced.after_warranty_cost,
           ced.business_process_id,
           line_category_code, -- Required if the charge line is RETURN
           line_type_id, --  Required
           txn_billing_type_id,
           coverage_bill_rate_id,
           interface_to_oe_flag
      FROM cs_estimate_details ced,
           cs_bus_process_txns cbpt,
           cs_incidents_all_b  t
     WHERE /*ced.transaction_type_id = 11
                                                                                                                                                                                                                                                                                                                                                                      AND*/
     t.incident_id = ced.incident_id
    
     AND incident_occurred_date BETWEEN c_from_contract_date AND
     c_to_contract_date
     AND ced.attribute4 IS NULL -- not calculated
     AND nvl(ced.line_submitted, 'N') != 'Y'
     AND cbpt.business_process_id = ced.business_process_id
     AND ced.transaction_type_id = cbpt.transaction_type_id
     AND cbpt.attribute2 = 'SPARE PARTS'
     AND ced.incident_id = c_incident_id;

  CURSOR c_tm_lines(c_incident_id NUMBER) IS
    SELECT t.incident_number,
           ced.incident_id,
           ced.estimate_detail_id,
           cdl.debrief_line_id,
           cbpt.attribute2,
           ced.activity_start_date_time,
           t.customer_id,
           ced.business_process_id,
           ced.line_category_code,
           ced.line_type_id,
           ced.txn_billing_type_id,
           ced.coverage_bill_rate_id
      FROM cs_bus_process_txns cbpt,
           csf_debrief_lines   cdl,
           cs_estimate_details ced,
           cs_incidents_all_b  t
     WHERE cbpt.business_process_id = cdl.business_process_id
       AND cdl.debrief_line_id = ced.source_id
       AND cdl.transaction_type_id = cbpt.transaction_type_id
       AND cbpt.attribute1 = 'Y'
       AND cbpt.attribute2 = 'FOC VISITS'
       AND t.incident_id = ced.incident_id
       AND ced.attribute4 IS NULL -- not calculated
          
       AND nvl(ced.line_submitted, 'N') != 'Y'
       AND ced.incident_id = c_incident_id --;
     ORDER BY t.estimate_id;

  -- foc lines to check
  CURSOR c_foc_lines(c_incident_id        NUMBER,
                     c_from_contract_date DATE,
                     c_to_contract_date   DATE) IS
    SELECT t.incident_number,
           ced.incident_id,
           ced.estimate_detail_id,
           cdl.debrief_line_id,
           cbpt.attribute2,
           ced.activity_start_date_time,
           t.customer_id,
           t.incident_occurred_date
      FROM cs_bus_process_txns cbpt,
           csf_debrief_lines   cdl,
           cs_estimate_details ced,
           cs_incidents_all_b  t
     WHERE cbpt.business_process_id = cdl.business_process_id
       AND cdl.debrief_line_id = ced.source_id
       AND cdl.transaction_type_id = cbpt.transaction_type_id
       AND cbpt.attribute1 = 'Y'
       AND cbpt.attribute2 = 'FOC VISITS'
       AND t.incident_id = ced.incident_id
       AND ced.incident_id = c_incident_id
       AND ced.attribute4 IS NULL -- not calculated
       AND ced.line_submitted = 'N'
       AND nvl(ced.line_submitted, 'N') != 'Y'
       AND incident_occurred_date BETWEEN c_from_contract_date AND
           c_to_contract_date
     ORDER BY t.estimate_id;

  CURSOR c_val(c_org_id            NUMBER,
               c_item_id           NUMBER,
               c_platform_code     VARCHAR2,
               c_platform_sub_code VARCHAR2,
               c_date              DATE) IS
    SELECT t.*
      FROM xxoks_cover_lines t, xxoks_cover_header h
    
     WHERE h.inventory_item_id = c_item_id
       AND h.org_id = c_org_id
       AND t.header_id = h.header_id
       AND t.platform_code = c_platform_code
       AND t.platform_sub_code = c_platform_sub_code
       AND trunc(c_date) BETWEEN h.from_date AND h.to_date;

  g_wkhrs_item_seg VARCHAR2(50) := 'WKHRS-ON-SITE-DAY';

  TYPE c_arr IS TABLE OF VARCHAR2(500) INDEX BY BINARY_INTEGER;
  g_arr c_arr;

  ----------------------------------------
  -- get_err_messages
  -----------------------------------------

  FUNCTION get_err_messages RETURN VARCHAR2 IS
    l_err_message VARCHAR2(32000);
  BEGIN
  
    FOR i IN 1 .. g_arr.count LOOP
    
      l_err_message := l_err_message || g_arr(i) || chr(10);
    
    END LOOP;
    RETURN l_err_message;
  END;

  -----------------------------------------
  -- get_incident_row
  ----------------------------------------
  FUNCTION get_incident_row(p_incident_id NUMBER)
    RETURN cs_incidents_all_b%ROWTYPE IS
  
    l_rec cs_incidents_all_b%ROWTYPE;
  BEGIN
    SELECT *
      INTO l_rec
      FROM cs_incidents_all_b
     WHERE incident_id = p_incident_id;
  
    RETURN l_rec;
  END;

  -------------------------------------------
  -- get_cover_param_text
  --------------------------------------------
  FUNCTION get_cover_param_text(p_org_id            NUMBER,
                                p_item_id           NUMBER,
                                p_platform_code     IN VARCHAR2,
                                p_platform_sub_code IN VARCHAR2,
                                p_to_date           DATE DEFAULT SYSDATE)
    RETURN VARCHAR2 IS
    l_rec xxoks_cover_lines%ROWTYPE;
  BEGIN
    OPEN c_val(p_org_id,
               p_item_id,
               p_platform_code,
               p_platform_sub_code,
               p_to_date);
    FETCH c_val
      INTO l_rec;
    CLOSE c_val;
  
    RETURN l_rec.text_value;
  
  END;

  -------------------------------------------
  -- get_cover_param_number
  --------------------------------------------
  FUNCTION get_cover_param_number(p_org_id            NUMBER,
                                  p_item_id           NUMBER,
                                  p_platform_code     IN VARCHAR2,
                                  p_platform_sub_code IN VARCHAR2,
                                  p_to_date           DATE DEFAULT SYSDATE)
    RETURN NUMBER IS
    l_rec xxoks_cover_lines%ROWTYPE;
  BEGIN
    OPEN c_val(p_org_id,
               p_item_id,
               p_platform_code,
               p_platform_sub_code,
               p_to_date);
    FETCH c_val
      INTO l_rec;
    CLOSE c_val;
  
    RETURN l_rec.number_value;
  
  END;

  -------------------------------------------
  -- get_cover_param_date
  --------------------------------------------
  FUNCTION get_cover_param_date(p_org_id            NUMBER,
                                p_item_id           NUMBER,
                                p_platform_code     IN VARCHAR2,
                                p_platform_sub_code IN VARCHAR2,
                                p_to_date           DATE DEFAULT SYSDATE)
    RETURN DATE IS
    l_rec xxoks_cover_lines%ROWTYPE;
  BEGIN
    OPEN c_val(p_org_id,
               p_item_id,
               p_platform_code,
               p_platform_sub_code,
               p_to_date);
    FETCH c_val
      INTO l_rec;
    CLOSE c_val;
  
    RETURN l_rec.date_value;
  
  END;

  --------------------------------------------------
  -- get_visit_count
  --------------------------------------------------
  FUNCTION get_visit_count(p_party_id    NUMBER,
                           p_resource_id NUMBER,
                           p_from_date   DATE,
                           p_to_date     DATE) RETURN NUMBER IS
  
    CURSOR c IS
      SELECT *
        FROM xxcsf_foc_counter t
       WHERE t.resource_id = p_resource_id
         AND t.party_id = p_party_id
         AND (trunc(t.labor_start_date) BETWEEN trunc(p_from_date) AND
             trunc(p_to_date) OR trunc(t.labor_end_date) BETWEEN
             trunc(p_from_date) AND trunc(p_to_date));
  
    l_interval  NUMBER;
    l_interval2 NUMBER;
    TYPE d_arr IS TABLE OF NUMBER INDEX BY VARCHAR2(8);
    l_arr   d_arr;
    l_count NUMBER := 0;
  BEGIN
    l_interval := (trunc(p_to_date) - trunc(p_from_date)) + 1;
  
    FOR d IN 0 .. l_interval - 1 LOOP
    
      l_arr(to_char(p_from_date + d, 'ddmmyyyy')) := 1;
    
    END LOOP;
  
    FOR i IN c LOOP
      l_interval2 := (trunc(i.labor_end_date) - trunc(i.labor_start_date)) + 1;
      FOR d IN 0 .. l_interval2 - 1 LOOP
      
        l_arr(to_char(i.labor_start_date + d, 'ddmmyyyy')) := 0;
      
      END LOOP;
    
    END LOOP;
  
    -- count 1
    FOR d IN 0 .. l_interval - 1 LOOP
      log(p_from_date + d || '= ' ||
          l_arr(to_char(p_from_date + d, 'ddmmyyyy')));
      IF l_arr(to_char(p_from_date + d, 'ddmmyyyy')) = 1 THEN
        l_count := l_count + 1;
      END IF;
    
    END LOOP;
    RETURN l_count;
  END;

  -----------------------------------------
  -- get_visit_count4contract
  -------------------------------------------

  FUNCTION get_visit_count4contract(p_incident_id     NUMBER,
                                    p_debrief_line_id NUMBER) RETURN NUMBER IS
    --l_contract_start_date DATE;
    --l_customer_id         NUMBER;
    l_sum NUMBER;
  
    l_contract_line_id   NUMBER;
    l_contract_header_id NUMBER;
    l_from_date          DATE;
    l_to_date            DATE;
    l_inventory_id       NUMBER;
    l_org_id             NUMBER;
  
  BEGIN
  
    xxoks_cover.get_contract_info4incident(p_incident_id        => p_incident_id,
                                           p_contract_header_id => l_contract_header_id,
                                           p_contract_line_id   => l_contract_line_id,
                                           p_from_date          => l_from_date,
                                           p_to_date            => l_to_date,
                                           p_inventory_id       => l_inventory_id,
                                           p_org_id             => l_org_id);
  
    SELECT SUM(t.counter)
      INTO l_sum
      FROM xxcsf_foc_counter t
     WHERE t.contract_line_id = l_contract_line_id
       AND t.debrief_line_id <= nvl(p_debrief_line_id, t.debrief_line_id);
  
    RETURN nvl(l_sum, 0);
    /* IF nvl(l_sum, 0) = 0 THEN
      RETURN 99999;
    ELSE
      RETURN l_sum;
    END IF;*/
  
  END;

  -----------------------------------------
  -- get_visit_count4contract
  -------------------------------------------

  FUNCTION get_dbf_count4incident(p_incident_id NUMBER) RETURN NUMBER IS
    --l_contract_start_date DATE;
    --l_customer_id         NUMBER;
    l_count NUMBER := 0;
  
  BEGIN
  
    FOR i IN c_tm_lines(p_incident_id) LOOP
      l_count := l_count + 1;
    END LOOP;
  
    RETURN l_count;
  END;

  -- ----------------------------------------
  --  build_ history
  --------------------------------------------
  PROCEDURE history_build IS
  
    CURSOR c IS
      SELECT cdl.debrief_line_id,
             cdl.labor_start_date,
             cdl.labor_end_date,
             jtas.resource_id,
             jtb.customer_id,
             cdh.processed_flag
      
        FROM cs_incidents_all_b       ciab, --SR Table
             jtf_tasks_b              jtb, --Tasks Table
             csf_debrief_headers      cdh, --debreif header
             csf_debrief_lines        cdl, --debrief lines
             jtf_task_all_assignments jtas --assisgnments table
       WHERE ciab.incident_id = jtb.source_object_id
         AND cdl.debrief_header_id = cdh.debrief_header_id
         AND cdh.task_assignment_id = jtas.task_assignment_id
         AND jtas.task_id = jtb.task_id
         AND cdl.charge_upload_status = 'SUCCEEDED'
         AND is_valid_foc(cdl.business_process_id, cdl.transaction_type_id) = 'Y'
            -- AND jtas.resource_id = 100002083
            
         AND cdl.labor_start_date >= '01-jan-11'
       ORDER BY cdl.debrief_line_id;
  
    -- check only Relevant tasks
  BEGIN
  
    DELETE FROM xxcsf_foc_counter;
    COMMIT;
  
    -- IF l_att2 = 'Y' THEN
  
    -- check previous debriefs
  
    FOR i IN c LOOP
    
      INSERT INTO xxcsf_foc_counter
        (line_id,
         debrief_line_id,
         labor_start_date,
         labor_end_date,
         party_id,
         --processedflag_code,
         resource_id,
         counter,
         last_update_date,
         last_updated_by,
         creation_date,
         created_by,
         last_update_login)
      VALUES
      
        (xxcsf_foc_counter_seq.nextval,
         i.debrief_line_id,
         i.labor_start_date,
         i.labor_end_date,
         i.customer_id, --party_id,
         -- i.processed_flag, --processedflag_code,
         i.resource_id,
         xxoks_cover.get_visit_count(i.customer_id,
                                     i.resource_id,
                                     i.labor_start_date,
                                     i.labor_end_date),
         SYSDATE, --last_update_date,
         fnd_global.user_id, --last_updated_by,
         SYSDATE, --creation_date,
         fnd_global.user_id, --created_by,
         fnd_global.login_id --last_update_login
         );
      COMMIT;
    END LOOP;
    COMMIT;
  END;

  ---------------------------------------
  -- is_valid_debrief
  ---------------------------------------

  FUNCTION is_valid_foc(p_business_process_id NUMBER,
                        p_transaction_type_id NUMBER) RETURN VARCHAR2 IS
    l_tmp VARCHAR2(50);
  BEGIN
  
    SELECT cbpt.attribute1
      INTO l_tmp
      FROM cs_bus_process_txns cbpt
     WHERE cbpt.business_process_id = p_business_process_id
       AND cbpt.transaction_type_id = p_transaction_type_id;
    RETURN l_tmp;
  EXCEPTION
    WHEN OTHERS THEN
      RETURN 'N';
  END;
  -------------------------------------
  -- create_charge_record
  -------------------------------------

  PROCEDURE create_charge_record(p_charges_rec cs_charge_details_pub.charges_rec_type,
                                 p_err_code    OUT NUMBER,
                                 p_err_message OUT VARCHAR2) IS
  
    l_return_status         VARCHAR2(1);
    l_msg_count             NUMBER;
    l_msg_index_out         NUMBER;
    l_msg_data              VARCHAR2(1000);
    l_object_version_number NUMBER;
    l_estimate_detail_id    NUMBER;
    l_line_number           NUMBER;
    l_err_msg               VARCHAR2(2000);
  BEGIN
    -- Call the procedure
    cs_charge_details_pub.create_charge_details(p_api_version   => 1.0,
                                                p_init_msg_list => fnd_api.g_true,
                                                p_commit        => fnd_api.g_false,
                                                
                                                p_validation_level      => fnd_api.g_valid_level_none,
                                                x_return_status         => l_return_status,
                                                x_msg_count             => l_msg_count,
                                                x_object_version_number => l_object_version_number,
                                                x_msg_data              => l_msg_data,
                                                x_estimate_detail_id    => l_estimate_detail_id,
                                                x_line_number           => l_line_number,
                                                /* p_resp_appl_id          => :p_resp_appl_id,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                
                                                                                                                                                                                                
                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                p_resp_id               => :p_resp_id,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                
                                                                                                                                                                                                
                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                p_user_id               => :p_user_id,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                
                                                                                                                                                                                                
                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                p_login_id              => :p_login_id,*/
                                                p_transaction_control => fnd_api.g_true,
                                                p_charges_rec         => p_charges_rec);
  
    IF l_return_status != fnd_api.g_ret_sts_success THEN
      log('Error while creating charge');
      log('----------------------------');
      FOR i IN 1 .. l_msg_count LOOP
        p_err_code := 1;
        fnd_msg_pub.get(p_msg_index     => i,
                        p_data          => l_msg_data,
                        p_encoded       => fnd_api.g_false,
                        p_msg_index_out => l_msg_index_out);
        log('Err' || l_msg_data);
        l_err_msg     := l_err_msg || l_msg_data || chr(10);
        p_err_message := l_err_msg;
      END LOOP;
    
      -- RAISE invalid_charge;
    ELSE
      log('Created charge: x_estimate_detail_id=' || l_estimate_detail_id);
      p_err_code    := 0;
      p_err_message := NULL;
    END IF;
  
  END;

  -------------------------------------
  -- update charge
  -------------------------------------
  PROCEDURE update_charge_record(p_charges_rec cs_charge_details_pub.charges_rec_type,
                                 p_err_code    OUT NUMBER,
                                 p_err_message OUT VARCHAR2) IS
  
    --l_org_id                NUMBER := 81; --
    l_return_status VARCHAR2(1);
    l_msg_count     NUMBER;
    l_msg_index_out NUMBER;
    l_msg_data      VARCHAR2(1000);
    l_err_msg       VARCHAR2(1000);
    --l_user_id               NUMBER := 3850;
    l_object_version_number NUMBER;
  
  BEGIN
  
    fnd_msg_pub.initialize;
    cs_charge_details_pub.update_charge_details(p_api_version           => 1.0,
                                                p_init_msg_list         => fnd_api.g_true,
                                                p_commit                => fnd_api.g_false,
                                                x_return_status         => l_return_status,
                                                x_msg_count             => l_msg_count,
                                                x_object_version_number => l_object_version_number,
                                                x_msg_data              => l_msg_data,
                                                p_resp_appl_id          => fnd_global.resp_appl_id,
                                                p_resp_id               => fnd_global.resp_id,
                                                p_user_id               => fnd_global.user_id,
                                                p_transaction_control   => fnd_api.g_true,
                                                p_charges_rec           => p_charges_rec);
  
    IF l_return_status != fnd_api.g_ret_sts_success THEN
    
      FOR i IN 1 .. l_msg_count LOOP
        p_err_code := 1;
        fnd_msg_pub.get(p_msg_index     => i,
                        p_data          => l_msg_data,
                        p_encoded       => fnd_api.g_false,
                        p_msg_index_out => l_msg_index_out);
        log('Err' || l_msg_data);
        l_err_msg     := l_err_msg || l_msg_data || chr(10);
        p_err_message := l_err_msg;
      END LOOP;
      -- RAISE invalid_charge;
    ELSE
      p_err_code    := 0;
      p_err_message := NULL;
    END IF;
  
  END;

  --------------------------------------------------
  -- recalculate

  -- p_type  out VALUE value /PCT percent
  --------------------------------------------------

  PROCEDURE get_foc_definition(p_incident_id NUMBER,
                               p_type        OUT VARCHAR2,
                               p_foc_value   OUT NUMBER) IS
  
    l_platform_value NUMBER;
    l_platform_pct   NUMBER;
    --
    l_contract_header_id NUMBER;
    l_contract_line_id   NUMBER;
    l_from_date          DATE;
    l_to_date            DATE;
    l_inventory_id       NUMBER;
    l_org_id             NUMBER;
  
    l_incidents_rec cs_incidents_all_b%ROWTYPE;
  
    CURSOR c_ib IS
      SELECT 'VALUE', cii.attribute15
        FROM cs_incidents_all_b ciab, csi_item_instances cii
       WHERE ciab.customer_product_id = cii.instance_id
         AND ciab.incident_id = p_incident_id;
  
    CURSOR c_party IS
      SELECT 'VALUE', hp.attribute6
        FROM cs_incidents_all_b ciab, hz_parties hp
       WHERE ciab.customer_id = hp.party_id
         AND hp.attribute6 IS NOT NULL
         AND ciab.incident_id = p_incident_id;
  
    CURSOR c_platform(c_org_id NUMBER, c_item_id NUMBER, c_to_date DATE) IS
      SELECT xxoks_cover.get_cover_param_number(c_org_id,
                                                c_item_id,
                                                'FOC VISITS',
                                                'VISITS CONST',
                                                c_to_date) visit_const,
             xxoks_cover.get_cover_param_number(c_org_id,
                                                c_item_id,
                                                'FOC VISITS',
                                                'IB PCT',
                                                c_to_date) ib_pct
      
        FROM dual;
  
    --l_rec cs_sr_incidents_v_sec%ROWTYPE;
  
  BEGIN
  
    -- get IB level
    ------------------
    OPEN c_ib;
    FETCH c_ib
      INTO p_type, p_foc_value;
    CLOSE c_ib;
  
    IF p_foc_value IS NOT NULL THEN
      RETURN;
    END IF;
    -- get Account level
    ----------------------
  
    OPEN c_party;
    FETCH c_party
      INTO p_type, p_foc_value;
    CLOSE c_party;
  
    IF p_foc_value IS NOT NULL THEN
      RETURN;
    END IF;
  
    -- check platform
    ------------------------
  
    xxoks_cover.get_contract_info4incident(p_incident_id        => p_incident_id,
                                           p_contract_header_id => l_contract_header_id,
                                           p_contract_line_id   => l_contract_line_id,
                                           p_from_date          => l_from_date,
                                           p_to_date            => l_to_date,
                                           p_inventory_id       => l_inventory_id,
                                           p_org_id             => l_org_id);
  
    l_incidents_rec := get_incident_row(p_incident_id);
    OPEN c_platform(l_org_id,
                    l_inventory_id,
                    l_incidents_rec.incident_occurred_date);
    FETCH c_platform
      INTO l_platform_value, l_platform_pct;
    CLOSE c_platform;
  
    IF l_platform_value IS NOT NULL THEN
      p_type      := 'VALUE';
      p_foc_value := l_platform_value;
    
    ELSIF l_platform_pct IS NOT NULL THEN
    
      p_type      := 'PCT';
      p_foc_value := l_platform_pct;
    END IF;
  
  END;

  --------------------------------------------------
  -- recalculate
  --------------------------------------------------

  PROCEDURE recalculate(p_err_code    OUT NUMBER,
                        p_err_message OUT VARCHAR2,
                        p_incident_id NUMBER) IS
  
    l_tm VARCHAR2(1);
    --l_err_message  VARCHAR2(32000);
    l_err_code     NUMBER;
    l_err_code_tmp NUMBER;
    --l_is_submit_allowed varchar2(5);
  BEGIN
    p_err_code     := 0;
    l_err_code_tmp := 0;
    g_arr .delete;
  
    -- CHECK PROFILE
    IF nvl(fnd_profile.value('XXCS_SR_CHARGE_CALCULATE'), 'N') = 'N' THEN
      log('Profile XXCS_SR_CHARGE_CALCULATE=N');
      log('Exit calculation mode');
      p_err_code    := 2;
      p_err_message := get_err_messages;
      RETURN;
    END IF;
  
    -- CHECK Relevant lines Exists
  
    IF is_submit_allowed(p_incident_id) = 'TRUE' THEN
      log('No Changes For Re-calculate');
      p_err_code    := 2;
      p_err_message := get_err_messages;
      RETURN;
    
    END IF;
  
    log('incident_id=' || p_incident_id);
  
    l_tm := is_tm(p_incident_id);
    IF l_tm = 'Y' THEN
      ----------- T & M --------
      --  l_err_message := 'Starting T & M ';
      calc_tm(p_incident_id, l_err_code, p_err_message);
      l_err_code_tmp := l_err_code;
    ELSIF l_tm = 'N' THEN
      ----------- foc -------------
      -- l_err_message := 'Starting FOC ';
      calc_foc(p_incident_id, l_err_code, p_err_message);
    
      l_err_code_tmp := greatest(l_err_code_tmp, l_err_code);
    
    ELSE
      log('No cover contract found for p_incident_id=' || p_incident_id);
    END IF;
  
    ------------- sp---------
  
    calc_sp(p_incident_id, l_err_code, p_err_message);
    l_err_code_tmp := greatest(l_err_code_tmp, l_err_code);
  
    p_err_message := get_err_messages;
    p_err_code    := l_err_code_tmp;
  EXCEPTION
  
    WHEN OTHERS THEN
      p_err_code := 1;
    
  END;
  --------------------------------------------------
  -- calc_tm
  --------------------------------------------------

  PROCEDURE calc_tm(p_incident_id NUMBER,
                    p_err_code    OUT NUMBER,
                    p_err_message OUT VARCHAR2) IS
  
    --
    l_charges_rec cs_charge_details_pub.charges_rec_type := cs_charge_details_pub.g_miss_chrg_rec;
  
    l_contract_header_id NUMBER;
    l_contract_line_id   NUMBER;
    --l_from_date           DATE;
    --l_to_date             DATE;
    --l_inventory_id        NUMBER;
    l_org_id              NUMBER;
    l_unit_price          NUMBER;
    l_curr_code           VARCHAR2(5);
    l_dbf_count           NUMBER;
    l_price_header_id     NUMBER;
    l_wkhrs_item_id       NUMBER;
    l_uom                 VARCHAR2(50);
    l_name                VARCHAR2(240);
    l_business_process_id NUMBER;
    --
    l_err_code    NUMBER;
    l_err_message VARCHAR2(500);
  BEGIN
  
    p_err_code := 0;
    log('---------------- ');
    log('Starting T & M  ');
    log('---------------- ');
  
    xxoks_cover.get_tm_related_info(p_incident_id         => p_incident_id,
                                    p_unit_price          => l_unit_price,
                                    p_curr_code           => l_curr_code,
                                    p_price_header_id     => l_price_header_id,
                                    p_wkhrs_item_id       => l_wkhrs_item_id,
                                    p_uom                 => l_uom,
                                    p_org_id              => l_org_id,
                                    p_business_process_id => l_business_process_id,
                                    p_contract_id         => l_contract_header_id,
                                    p_contract_line_id    => l_contract_line_id);
  
    IF l_wkhrs_item_id IS NULL THEN
      p_err_code    := 1;
      p_err_message := 'Err-001: No Price found for item=' ||
                       g_wkhrs_item_seg || ' in List_price_id=' ||
                       l_price_header_id ||
                       ' from xxoks_cover.get_tm_related_info : p_incident_id=' ||
                       p_incident_id;
    
      p_err_code := 1;
      log(p_err_message);
      RETURN;
    END IF;
  
    -- get quantity for new line
  
    l_dbf_count := get_dbf_count4incident(p_incident_id);
    -- log('l_dbf_count=' || l_dbf_count);
  
    IF l_dbf_count = 0 THEN
      p_err_message := 'Err-002: No charge lines found for T & M';
      log(p_err_message);
      RETURN;
    END IF;
  
    -- set no chrage on relevant lines
  
    FOR i IN c_tm_lines(p_incident_id) LOOP
      l_charges_rec := cs_charge_details_pub.g_miss_chrg_rec;
      BEGIN
      
        SELECT papf.full_name
          INTO l_name
          FROM per_all_people_f      papf,
               jtf_rs_resource_extns jrre,
               jtf_rs_salesreps      jrs,
               cs_incidents_all_b    ciab
         WHERE papf.party_id = jrre.person_party_id
           AND jrre.attribute2 = 'YES'
           AND jrs.resource_id = jrre.resource_id
           AND ciab.org_id = jrs.org_id
           AND ciab.incident_id = p_incident_id
           AND rownum = 1;
      EXCEPTION
        WHEN OTHERS THEN
          NULL;
      END;
    
      l_charges_rec.incident_id      := i.incident_id;
      l_charges_rec.contract_line_id := l_contract_line_id;
      l_charges_rec.contract_id      := l_contract_header_id;
    
      l_charges_rec.estimate_detail_id   := i.estimate_detail_id;
      l_charges_rec.no_charge_flag       := 'Y';
      l_charges_rec.attribute4           := 'Changed';
      l_charges_rec.interface_to_oe_flag := 'N';
      l_charges_rec.attribute1           := 'Other';
      l_charges_rec.attribute3           := 'Re-calculated';
      l_charges_rec.attribute2           := l_name;
    
      -- update_charge_record
      log('estimate_detail_id=' || i.estimate_detail_id ||
          ' Update record ststus=' || l_charges_rec.attribute4);
    
      xxoks_cover.update_charge_record(p_charges_rec => l_charges_rec,
                                       p_err_code    => l_err_code,
                                       p_err_message => l_err_message);
    
      IF l_err_code = 0 THEN
      
        log('Success updating estimate_detail_id=' || i.estimate_detail_id);
        COMMIT;
      ELSE
        p_err_code := 1;
        log('Err-003 : Unable to update incident_number=' ||
            i.incident_number || ' estimate_detail_id=' ||
            i.estimate_detail_id || ' ' || l_err_message);
        p_err_message := 'Incident_number=' || i.incident_number ||
                         l_err_message;
      END IF;
    
    END LOOP;
  
    IF p_err_code = 1 THEN
      log('Process stoped , Rollback was made , see error log');
      RETURN;
    END IF;
  
    -- add charge line
    l_charges_rec := cs_charge_details_pub.g_miss_chrg_rec;
  
    SELECT ciab.bill_to_party_id,
           ciab.bill_to_account_id,
           ciab.bill_to_site_id,
           ciab.bill_to_contact_id,
           ciab.ship_to_party_id,
           ciab.ship_to_account_id,
           ciab.ship_to_site_id,
           ciab.ship_to_contact_id
      INTO l_charges_rec.bill_to_party_id,
           l_charges_rec.bill_to_account_id,
           l_charges_rec.invoice_to_org_id,
           l_charges_rec.bill_to_contact_id,
           l_charges_rec.ship_to_party_id,
           l_charges_rec.ship_to_account_id,
           l_charges_rec.ship_to_org_id,
           l_charges_rec.ship_to_contact_id
    
      FROM cs_incidents_all_b ciab
     WHERE ciab.incident_id = p_incident_id;
  
    l_charges_rec.interface_to_oe_flag := 'Y';
    l_charges_rec.contract_line_id     := l_contract_line_id;
    l_charges_rec.contract_id          := l_contract_header_id;
    l_charges_rec.attribute4           := 'Changed';
    l_charges_rec.no_charge_flag       := 'N';
    l_charges_rec.org_id               := l_org_id;
    l_charges_rec.incident_id          := p_incident_id;
    l_charges_rec.inventory_item_id_in := l_wkhrs_item_id;
  
    l_charges_rec.quantity_required := l_dbf_count;
    -------t_charges_rec.serial_number        := cur_charge.serial_number;   ---closed by Dorit
    l_charges_rec.currency_code           := l_curr_code;
    l_charges_rec.list_price              := l_unit_price;
    l_charges_rec.selling_price           := l_unit_price;
    l_charges_rec.con_pct_over_list_price := l_unit_price;
    l_charges_rec.after_warranty_cost     := l_unit_price;
  
    --
    l_charges_rec.txn_billing_type_id  := 48;
    l_charges_rec.transaction_type_id  := 14;
    l_charges_rec.business_process_id  := l_business_process_id;
    l_charges_rec.unit_of_measure_code := l_uom;
    l_charges_rec.line_category_code   := 'ORDER';
    l_charges_rec.price_list_id        := l_price_header_id;
    l_charges_rec.source_code          := 'SR';
    l_charges_rec.source_id            := p_incident_id;
    l_charges_rec.original_source_id   := p_incident_id;
    l_charges_rec.original_source_code := 'SR';
    l_charges_rec.charge_line_type     := 'ACTUAL';
  
    xxoks_cover.create_charge_record(p_charges_rec => l_charges_rec,
                                     p_err_code    => p_err_code,
                                     p_err_message => l_err_message);
  
    IF p_err_code = 0 THEN
      COMMIT;
      log('New Charge Record Created');
    ELSE
      ROLLBACK;
      log('Unable to create  Charge Record ' || l_err_message);
    END IF;
  
    -------------------
    p_err_message := p_err_message || ' ' || l_err_message;
  EXCEPTION
    WHEN OTHERS THEN
      p_err_code    := 1;
      p_err_message := 'OBJ-0010 : General error in calc_tm -' || SQLERRM;
  END;

  --------------------------------------------------
  -- calc_foc
  --------------------------------------------------

  PROCEDURE calc_foc(p_incident_id NUMBER,
                     p_err_code    OUT NUMBER,
                     p_err_message OUT VARCHAR2) IS
    l_charges_rec cs_charge_details_pub.charges_rec_type := cs_charge_details_pub.g_miss_chrg_rec;
  
    l_foc_type            VARCHAR2(10);
    l_foc_value           NUMBER;
    l_contract_past_visit NUMBER;
    l_charge_flag         VARCHAR2(1);
    l_printer_count       NUMBER;
    --
  
    l_contract_header_id NUMBER;
    l_contract_line_id   NUMBER;
    l_from_date          DATE;
    l_to_date            DATE;
    l_inventory_id       NUMBER;
    l_org_id             NUMBER;
    --
    l_err_code    NUMBER;
    l_err_message VARCHAR2(500);
    l_rows_count  NUMBER := 0;
    l_name        VARCHAR2(240);
  BEGIN
    log('--------------- ');
    log('Starting FOC ');
    log('--------------- ');
    p_err_code := 0;
  
    get_foc_definition(p_incident_id, l_foc_type, l_foc_value);
    IF l_foc_value IS NULL THEN
      log('No foc value found');
      p_err_message := 'Incident_id=' || p_incident_id ||
                       ' No foc value found';
      RETURN;
    ELSE
      log('FOC type=' || l_foc_type || ' FOC value=' || l_foc_value);
    END IF;
  
    xxoks_cover.get_contract_info4incident(p_incident_id        => p_incident_id,
                                           p_contract_header_id => l_contract_header_id,
                                           p_contract_line_id   => l_contract_line_id,
                                           p_from_date          => l_from_date,
                                           p_to_date            => l_to_date,
                                           p_inventory_id       => l_inventory_id,
                                           p_org_id             => l_org_id);
    FOR i IN c_foc_lines(p_incident_id, l_from_date, l_to_date) LOOP
      l_charges_rec         := cs_charge_details_pub.g_miss_chrg_rec;
      l_contract_past_visit := 0;
      l_charge_flag         := 'Y';
      -- get init def ---
    
      ---------------------------------
      -- start loop
      ---------------------------------
      log('-----------------------------------');
      log('Working on estimate_detail_id=' || i.estimate_detail_id);
    
      BEGIN
        l_rows_count := l_rows_count + 1;
        --  check charge / no charge
        l_contract_past_visit := xxoks_cover.get_visit_count4contract(i.incident_id,
                                                                      i.debrief_line_id);
      
        log('Contract past visit= ' || l_contract_past_visit);
      
        IF l_foc_type = 'VALUE' THEN
        
          IF l_contract_past_visit <= l_foc_value THEN
            -- no charge
          
            l_charge_flag := 'N';
          
          END IF;
        ELSIF l_foc_type = 'PCT' THEN
        
          l_printer_count := get_printer_count(p_incident_id => i.incident_id);
        
          IF l_contract_past_visit <=
             ceil(l_foc_value * l_printer_count / 100) THEN
            l_charge_flag := 'N';
          END IF;
        END IF;
      
        IF l_charge_flag = 'N' THEN
        
          -- update no charge
          l_contract_header_id := NULL;
          l_contract_line_id   := NULL;
          l_from_date          := NULL;
          l_to_date            := NULL;
          BEGIN
          
            SELECT papf.full_name
              INTO l_name
              FROM per_all_people_f      papf,
                   jtf_rs_resource_extns jrre,
                   jtf_rs_salesreps      jrs,
                   cs_incidents_all_b    ciab
             WHERE papf.party_id = jrre.person_party_id
               AND jrre.attribute2 = 'YES'
               AND jrs.resource_id = jrre.resource_id
               AND ciab.org_id = jrs.org_id
               AND ciab.incident_id = p_incident_id
               AND rownum = 1;
          EXCEPTION
            WHEN OTHERS THEN
              NULL;
          END;
        
          l_charges_rec.incident_id      := i.incident_id;
          l_charges_rec.contract_line_id := l_contract_line_id;
          l_charges_rec.contract_id      := l_contract_header_id;
        
          l_charges_rec.estimate_detail_id   := i.estimate_detail_id;
          l_charges_rec.no_charge_flag       := 'Y';
          l_charges_rec.attribute1           := 'Other';
          l_charges_rec.attribute3           := 'Re-calculated';
          l_charges_rec.attribute2           := l_name;
          l_charges_rec.attribute4           := 'Changed';
          l_charges_rec.interface_to_oe_flag := 'N';
          -- update_charge_record
          log('estimate_detail_id=' || i.estimate_detail_id ||
              ' Update record ststus=' || l_charges_rec.attribute4);
        
          xxoks_cover.update_charge_record(p_charges_rec => l_charges_rec,
                                           p_err_code    => l_err_code,
                                           p_err_message => l_err_message);
        
          IF l_err_code = 0 THEN
            log('Success updating estimate_detail_id=' ||
                i.estimate_detail_id);
            COMMIT;
          ELSE
            ROLLBACK;
            p_err_code := 1;
            log('Err-005 : Unable to update incident_number=' ||
                i.incident_number || ' estimate_detail_id=' ||
                i.estimate_detail_id || ' ' || l_err_message);
            p_err_message := 'Incident_number=' || i.incident_number ||
                             l_err_message;
            RETURN;
          END IF;
        ELSE
        
          -- update for no relevant record
        
          -- l_charges_rec.estimate_detail_id := i.estimate_detail_id;
          -- l_charges_rec.attribute4         := 'Unchanged';
        
          UPDATE cs_estimate_details t
             SET t.attribute4 = 'Unchanged'
           WHERE t.estimate_detail_id = i.estimate_detail_id;
          COMMIT;
        
          log('estimate_detail_id=' || i.estimate_detail_id ||
              ' Update record ststus=Unchanged');
        
        END IF;
      
        --
      
      EXCEPTION
        WHEN OTHERS THEN
          p_err_code := 1;
          ROLLBACK;
          log('Err-005 :Unable to update incident_number=' ||
              i.incident_number || ' estimate_detail_id=' ||
              i.estimate_detail_id || ' ' || l_err_message || ' ' ||
              SQLERRM);
        
          p_err_message := p_err_message || ' ' ||
                           'Unable to update incident_number=' ||
                           i.incident_number || ' estimate_detail_id=' ||
                           i.estimate_detail_id || ' ' || l_err_message || ' ' ||
                           SQLERRM;
        
      END;
    
    END LOOP;
    COMMIT;
    --   IF l_rows_count = 0 THEN
    log(l_rows_count || ' Records found for FOC');
    -- p_err_message := p_err_message || chr(10) || l_rows_count ||
    --      ' records found';
  
    --  END IF;
  EXCEPTION
    WHEN OTHERS THEN
      p_err_code    := 1;
      p_err_message := 'Err-006 : General error in calc FOC -' || SQLERRM;
  END;

  --------------------------------------------------
  -- calc_foc
  --------------------------------------------------

  PROCEDURE calc_sp(p_incident_id NUMBER,
                    p_err_code    OUT NUMBER,
                    p_err_message OUT VARCHAR2) IS
  
    l_contract_line_id   NUMBER;
    l_contract_header_id NUMBER;
    l_from_date          DATE;
    l_to_date            DATE;
    l_inventory_id       NUMBER;
    l_org_id             NUMBER;
    l_source             VARCHAR2(50);
    l_identifier         VARCHAR2(100);
    l_discount           NUMBER;
  
    l_charges_rec cs_charge_details_pub.charges_rec_type := cs_charge_details_pub.g_miss_chrg_rec;
    l_err_code    NUMBER;
    l_err_message VARCHAR2(500);
    l_count_flag  NUMBER := 0;
  
  BEGIN
    log('---------------- ');
    log('Starting  SP ');
    log('----------------');
    p_err_code := 0;
    xxoks_cover.get_contract_info4incident(p_incident_id        => p_incident_id,
                                           p_contract_header_id => l_contract_header_id,
                                           p_contract_line_id   => l_contract_line_id,
                                           p_from_date          => l_from_date,
                                           p_to_date            => l_to_date,
                                           p_inventory_id       => l_inventory_id,
                                           p_org_id             => l_org_id);
  
    IF l_contract_line_id IS NULL THEN
      log('No contract found');
      p_err_message := 'Incident_id=' || p_incident_id ||
                       ' No contract found';
      RETURN;
    ELSE
      log('p_contract_header_id=' || l_contract_header_id ||
          ' p_contract_line_id=' || l_contract_line_id);
    END IF;
  
    --- get source
    l_source     := get_cover_param_text(p_org_id            => l_org_id,
                                         p_item_id           => l_inventory_id,
                                         p_platform_code     => 'SPARE PARTS',
                                         p_platform_sub_code => 'SOURCE');
    l_identifier := get_cover_param_text(p_org_id            => l_org_id,
                                         p_item_id           => l_inventory_id,
                                         p_platform_code     => 'SPARE PARTS',
                                         p_platform_sub_code => 'IDENTIFIER');
    log('Source=' || l_source);
    IF l_source = 'SR' AND l_identifier IS NOT NULL THEN
    
      log('SP Identifier=' || l_identifier);
    
      -- loop of
      FOR i IN c_sp_lines(p_incident_id, l_from_date, l_to_date) LOOP
        l_charges_rec := cs_charge_details_pub.g_miss_chrg_rec;
      
        l_count_flag := l_count_flag + 1;
        --l_discount   := NULL;
        l_discount := get_sp_item_discount(i.inventory_item_id,
                                           l_identifier);
      
        log('inventory_item_id=' || i.inventory_item_id || ' l_discount=' ||
            l_discount);
      
        ---
      
        ---
        -- update record
      
        l_charges_rec.estimate_detail_id := i.estimate_detail_id;
        --l_charges_rec.incident_id           := i.incident_id;
        -- l_charges_rec.business_process_id   := i.business_process_id;
        -- l_charges_rec.line_category_code    := i.line_category_code; -- Required if the charge line is RETURN
        --  l_charges_rec.line_type_id          := i.line_type_id; --  Required
        --  l_charges_rec.txn_billing_type_id   := i.txn_billing_type_id;
        --   l_charges_rec.coverage_bill_rate_id := i.coverage_bill_rate_id;
      
        --
        IF l_discount IS NULL THEN
        
          UPDATE cs_estimate_details t
             SET t.attribute4       = 'Unchanged',
                 t.last_update_date = SYSDATE,
                 t.last_updated_by  = fnd_global.user_id
           WHERE t.estimate_detail_id = i.estimate_detail_id;
        
          log('Success updating estimate_detail_id=' ||
              i.estimate_detail_id || ' Update record ststus=Unchanged');
          COMMIT;
        
        ELSE
        
          --
          l_charges_rec.interface_to_oe_flag := 'Y';
          l_charges_rec.contract_line_id     := l_contract_line_id;
          l_charges_rec.contract_id          := l_contract_header_id;
          l_charges_rec.attribute4           := 'Changed';
          l_charges_rec.attribute5           := 'Identifier=' ||
                                                l_identifier ||
                                                ',Discount=' || l_discount;
          l_charges_rec.selling_price        := i.selling_price *
                                                (1 - (l_discount / 100));
        
          xxoks_cover.update_charge_record(p_charges_rec => l_charges_rec,
                                           p_err_code    => l_err_code,
                                           p_err_message => l_err_message);
        
          IF l_err_code = 0 THEN
            log('Success updating estimate_detail_id=' ||
                i.estimate_detail_id || ' ' || l_charges_rec.attribute4);
            COMMIT;
          ELSE
            ROLLBACK;
            p_err_code := 1;
            log('Err-006: Unable to update estimate_detail_id=' ||
                i.estimate_detail_id || ' ' || l_err_message);
            p_err_message := 'Unable to update incident_id=' ||
                             i.incident_id || l_err_message;
          
          END IF;
        END IF;
        --
      END LOOP;
      log('Total SP records  =' || l_count_flag);
    END IF;
  EXCEPTION
    WHEN OTHERS THEN
      p_err_code    := 1;
      p_err_message := 'OBJ-008 : General error in calc_sp -' || SQLERRM;
    
  END;

  ----------------------------------------------------
  -- get_printer_count
  -------------------------------------------------

  FUNCTION get_printer_count(p_incident_id NUMBER) RETURN NUMBER IS
    l_tmp NUMBER;
  BEGIN
  
    SELECT COUNT(*) --ciab.incident_id, ciab.customer_product_id
      INTO l_tmp
      FROM cs_incidents_all_b    ciab,
           csi_item_instances    cii,
           csi_instance_statuses cis
     WHERE ciab.customer_id = cii.owner_party_id
       AND cii.instance_status_id = cis.instance_status_id
       AND cis.name IN ('Installed', 'Confirmed')
       AND cii.attribute8 IN
           (SELECT flex_value
              FROM fnd_flex_values_vl p, fnd_flex_value_sets vs
             WHERE p.flex_value_set_id = vs.flex_value_set_id
               AND vs.flex_value_set_name = 'XXCS_CS_REGIONS'
               AND p.attribute10 = 'Indirect'
               AND nvl(p.enabled_flag, 'N') = 'Y')
       AND ciab.incident_id = p_incident_id;
  
    log('Total Printers=' || l_tmp);
    RETURN l_tmp;
  
  END;

  -------------------------------------------
  -- get_contract_info4incident
  --------------------------------------------

  PROCEDURE get_contract_info4incident(p_incident_id        NUMBER,
                                       p_contract_header_id OUT NUMBER,
                                       p_contract_line_id   OUT NUMBER,
                                       p_from_date          OUT DATE,
                                       p_to_date            OUT DATE,
                                       p_inventory_id       OUT NUMBER,
                                       p_org_id             OUT NUMBER) IS
    CURSOR c IS
      SELECT okhab.start_date,
             okhab.end_date,
             okhab.id,
             cleb.id,
             xch.inventory_item_id,
             xch.org_id
        FROM okc_k_lines_b       cleb,
             okc_k_items         oki,
             okc_k_items         oki1,
             cs_incidents_all_b  ciab,
             okc_k_headers_all_b okhab,
             xxoks_cover_header  xch
       WHERE okhab.id = cleb.dnz_chr_id
         AND oki.cle_id = cleb.id
         AND cleb.sts_code = 'ACTIVE'
         AND to_number(oki.object1_id1) = xch.inventory_item_id
         AND ciab.incident_occurred_date BETWEEN xch.from_date AND
             xch.to_date
         AND oki1.object1_id1 = ciab.account_id
         AND oki1.dnz_chr_id = okhab.id
         AND ciab.org_id = xch.org_id
         AND ciab.incident_id = p_incident_id
      UNION ALL
      SELECT okhab.start_date,
             okhab.end_date,
             okhab.id,
             cleb1.id,
             xch.inventory_item_id,
             xch.org_id
        FROM okc_k_lines_b       cleb,
             okc_k_items         oki,
             okc_k_lines_b       cleb1,
             okc_k_items         oki1,
             cs_incidents_all_b  ciab,
             okc_k_headers_all_b okhab,
             xxoks_cover_header  xch
       WHERE okhab.id = cleb.dnz_chr_id
         AND oki.object1_id1 = ciab.customer_product_id
         AND oki.cle_id = cleb.id
         AND cleb.sts_code = 'ACTIVE'
         AND to_number(oki1.object1_id1) = xch.inventory_item_id
         AND ciab.incident_occurred_date BETWEEN xch.from_date AND
             xch.to_date
         AND oki1.cle_id = cleb1.id
         AND cleb1.chr_id = okhab.id
         AND ciab.org_id = xch.org_id
         AND ciab.incident_id = p_incident_id;
  BEGIN
    OPEN c;
    FETCH c
      INTO p_from_date,
           p_to_date,
           p_contract_header_id,
           p_contract_line_id,
           p_inventory_id,
           p_org_id;
  
    CLOSE c;
  
  END;

  -----------------------------------------------------
  -- get_incident_id
  -----------------------------------------------------

  FUNCTION get_incident_id(p_debrief_line_id NUMBER) RETURN NUMBER IS
  
    CURSOR c IS
      SELECT ciab.incident_id
        FROM cs_incidents_all_b       ciab, --SR Table
             jtf_tasks_b              jtb, --Tasks Table
             csf_debrief_headers      cdh, --debreif header
             csf_debrief_lines        cdl, --debrief lines
             jtf_task_all_assignments jtas --assisgnments table
       WHERE ciab.incident_id = jtb.source_object_id
         AND cdl.debrief_header_id = cdh.debrief_header_id
         AND cdh.task_assignment_id = jtas.task_assignment_id
         AND jtas.task_id = jtb.task_id
         AND cdl.debrief_line_id = p_debrief_line_id;
    l_tmp NUMBER;
  BEGIN
  
    OPEN c;
    FETCH c
      INTO l_tmp;
    CLOSE c;
  
    RETURN l_tmp;
  
  END;
  ------------------------------------------
  -- get_incedent_timezone_code
  -------------------------------------------
  FUNCTION get_incedent_timezone_code(p_incident_id NUMBER) RETURN VARCHAR2 IS
  
    CURSOR c IS
      SELECT fnd_timezones.get_code(l.timezone_id)
        FROM hz_locations l, cs_incidents_all_b ciab, hz_party_sites hps
       WHERE hps.party_site_id = ciab.incident_location_id
         AND l.location_id = hps.location_id
         AND ciab.incident_id = p_incident_id;
  
    l_tmp VARCHAR2(50);
  BEGIN
  
    OPEN c;
    FETCH c
      INTO l_tmp;
    CLOSE c;
  
    RETURN l_tmp;
  END;

  ------------------------------------------
  -- convert_date_
  -------------------------------------------

  FUNCTION convert_date2incident_tz(p_server_date DATE,
                                    p_incident_id NUMBER) RETURN DATE IS
  
  BEGIN
  
    RETURN fnd_timezones_pvt.adjust_datetime(date_time => p_server_date,
                                             from_tz   => fnd_timezones.get_server_timezone_code,
                                             to_tz     => get_incedent_timezone_code(p_incident_id));
  END;

  -------------------------------------------------
  -- get_foc_message
  -------------------------------------------------
  FUNCTION get_foc_message(p_incident_id NUMBER) RETURN VARCHAR2 IS
  
    l_type          VARCHAR2(50);
    l_foc_value     VARCHAR2(50);
    l_tmp           VARCHAR2(200);
    l_printer_count NUMBER;
    l_pct           VARCHAR2(50);
    l_used_visits   NUMBER;
    l_visits_left   NUMBER;
  BEGIN
  
    get_foc_definition(p_incident_id, l_type, l_foc_value);
    IF l_type = 'PCT' THEN
      l_pct           := l_foc_value;
      l_printer_count := get_printer_count(p_incident_id);
    
      l_foc_value := ceil(l_foc_value * l_printer_count / 100);
      l_tmp       := ' (' || l_pct || '% Of ' || l_printer_count || ')';
    END IF;
  
    l_used_visits := xxoks_cover.get_visit_count4contract(p_incident_id,
                                                          NULL);
    l_visits_left := nvl(greatest(0, l_foc_value - l_used_visits), 0);
    RETURN 'Entitled Visits=' || nvl(l_foc_value, 0) || l_tmp ||
    
    chr(10) || /*'Used visits=' || l_used_visits || chr(10) */
     'Visits left=' || l_visits_left;
  
    --if  (Entitled Visits (round up) - Used Visits)  < 0 then 0 else (Entitled Visits (round up) - Used Visits)
  
  END;

  --------------------------------------------------
  -- is_indirect
  -------------------------------------------------

  FUNCTION is_indirect(p_incident_id NUMBER) RETURN VARCHAR2 IS
  
    CURSOR c IS
    /*  SELECT 'Y' --csi.instance_id
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                FROM cs_incidents_all_b ciab, csi_item_instances cii
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               WHERE cii.attribute8 LIKE '%Indirect%'
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 AND ciab.customer_product_id = cii.instance_id
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 AND ciab.incident_id = p_incident_id;*/
    
      SELECT 'Y' --csi.instance_id
        FROM cs_incidents_all_b ciab, csi_item_instances cii
       WHERE ciab.customer_product_id = cii.instance_id
         AND ciab.incident_id = p_incident_id
         AND cii.attribute8 IN
             (SELECT flex_value
                FROM fnd_flex_values_vl p, fnd_flex_value_sets vs
               WHERE p.flex_value_set_id = vs.flex_value_set_id
                 AND vs.flex_value_set_name = 'XXCS_CS_REGIONS'
                 AND p.attribute10 = 'Indirect'
                 AND nvl(p.enabled_flag, 'N') = 'Y');
  
    l_tmp VARCHAR2(1);
  BEGIN
  
    OPEN c;
    FETCH c
      INTO l_tmp;
    CLOSE c;
  
    RETURN nvl(l_tmp, 'N');
  
  END;

  -------------------------------------------------------
  -- Is_TM
  -- is t & m
  -------------------------------------------------------

  FUNCTION is_tm(p_incident_id NUMBER) RETURN VARCHAR2 IS
    --l_contract_header_id NUMBER;
    --l_contract_line_id   NUMBER;
    --l_from_date          DATE;
    --l_to_date            DATE;
    --l_inventory_id       NUMBER;
    --l_org_id             NUMBER;
  
    l_tmp VARCHAR2(1);
  
    CURSOR c IS
      SELECT 'N' --cleb.dnz_chr_id Contract_id, to_char (cleb.id), okhab.scs_code, hp.party_name,TO_NUMBER(oki.object1_id1)
      
        FROM okc_k_lines_b       cleb,
             okc_k_items         oki,
             cs_incidents_all_b  ciab,
             hz_parties          hp,
             okc_k_headers_all_b okhab,
             okc_k_party_roles_b okprb --,
      
      -- fnd_flex_values_vl p,
      
      -- fnd_flex_value_sets vs
      
       WHERE cleb.sts_code = 'ACTIVE'
         AND cleb.id = oki.cle_id
         AND cleb.chr_id = okhab.id
         AND okhab.id = okprb.chr_id
         AND cleb.lse_id = 1
         AND to_number(okprb.object1_id1) = hp.party_id
         AND ciab.customer_id = hp.party_id
         AND ciab.incident_occurred_date BETWEEN cleb.start_date AND
             cleb.end_date
            -- and p.flex_value_set_id = vs.flex_value_set_id
            -- and vs.flex_value_set_name = 'XX_OKS_PARTNER_PROGRAM'
            -- AND flex_value = TO_NUMBER(oki.object1_id1)
         AND ciab.incident_id = p_incident_id
         AND oki.object1_id1 IN
             (SELECT flex_value
                FROM fnd_flex_values_vl p, fnd_flex_value_sets vs
               WHERE p.flex_value_set_id = vs.flex_value_set_id
                 AND vs.flex_value_set_name = 'XX_OKS_PARTNER_PROGRAM'
                 AND nvl(p.enabled_flag, 'N') = 'Y');
  BEGIN
  
    IF is_indirect(p_incident_id) = 'Y' THEN
    
      OPEN c;
      FETCH c
        INTO l_tmp;
      CLOSE c;
    
      RETURN nvl(l_tmp, 'Y');
    ELSE
      RETURN 'N';
    END IF;
  
  END;
  ------------------------------------------------
  -- get_tm_related_info
  -------------------------------------------------

  PROCEDURE get_tm_related_info(p_incident_id         NUMBER,
                                p_unit_price          OUT NUMBER,
                                p_curr_code           OUT VARCHAR2,
                                p_price_header_id     OUT NUMBER,
                                p_wkhrs_item_id       OUT NUMBER,
                                p_uom                 OUT VARCHAR2,
                                p_org_id              OUT NUMBER,
                                p_business_process_id OUT NUMBER,
                                p_contract_id         OUT NUMBER,
                                p_contract_line_id    OUT NUMBER) IS
  
    CURSOR c IS
      SELECT b.list_header_id,
             -- t.NAME price_list,
             msib.inventory_item_id,
             l.operand unit_price,
             b.currency_code,
             lv.product_uom_code,
             ciab.org_id,
             cbp.business_process_id,
             ciab.contract_id,
             ciab.contract_service_id
        FROM qp_list_headers_all_b b,
             
             qp_list_headers_tl    t,
             qp_list_lines         l,
             qp_list_lines_v       lv,
             qp_pricing_attributes qpa,
             mtl_system_items_b    msib,
             csi_item_instances    cii,
             cs_business_processes cbp,
             cs_incident_types_b   cit,
             cs_incidents_all_b    ciab
       WHERE cbp.business_process_id = cit.business_process_id
         AND ciab.incident_type_id = cit.incident_type_id
         AND l.list_header_id = t.list_header_id
         AND b.list_header_id = l.list_header_id
         AND t.language = 'US'
         AND l.list_line_id = qpa.list_line_id
         AND l.list_line_id = lv.list_line_id
         AND qpa.product_attr_value = msib.inventory_item_id(+)
         AND msib.organization_id(+) = 91
         AND (l.end_date_active IS NULL OR l.end_date_active > SYSDATE)
         AND b.list_header_id = cii.attribute11
         AND ciab.customer_product_id = cii.instance_id
         AND msib.segment1(+) = g_wkhrs_item_seg
         AND ciab.incident_id = p_incident_id
       ORDER BY msib.inventory_item_id;
  
  BEGIN
    OPEN c;
    FETCH c
      INTO p_price_header_id,
           p_wkhrs_item_id,
           p_unit_price,
           p_curr_code,
           p_uom,
           p_org_id,
           p_business_process_id,
           p_contract_id,
           p_contract_line_id;
  
    CLOSE c;
  
  END;

  ------------------------------------------------
  -- get_tm_related_info
  -------------------------------------------------

  FUNCTION get_sp_item_discount(p_item_id NUMBER, p_lookup_type VARCHAR2)
    RETURN NUMBER IS
  
    l_discount NUMBER;
  
    CURSOR c_lookup(c_item VARCHAR2) IS
      SELECT description
      
        FROM fnd_lookup_values_vl t
       WHERE lookup_code = c_item
         AND lookup_type = p_lookup_type --'XXOKS_SPCOV_SERVICECARE_DE'
         AND nvl(t.enabled_flag, 'N') = 'Y'
         AND SYSDATE BETWEEN t.start_date_active AND
             nvl(t.end_date_active, SYSDATE + 1);
  
    CURSOR c_item IS
      SELECT msi.material_billable_flag
        FROM mtl_system_items_b msi
       WHERE msi.inventory_item_id = p_item_id
         AND msi.organization_id = 91;
    l_material_billable_flag mtl_system_items_b.material_billable_flag%TYPE;
  BEGIN
  
    OPEN c_lookup(to_char(p_item_id));
    FETCH c_lookup
      INTO l_discount;
    CLOSE c_lookup;
  
    IF l_discount IS NULL THEN
      --  material_billable_flag
      OPEN c_item;
      FETCH c_item
        INTO l_material_billable_flag;
      CLOSE c_item;
    
      OPEN c_lookup(l_material_billable_flag);
      FETCH c_lookup
        INTO l_discount;
      CLOSE c_lookup;
    END IF;
  
    RETURN l_discount;
  END;
  ------------------------------------
  -- log
  ------------------------------------
  PROCEDURE log(p_message VARCHAR2) IS
  BEGIN
    dbms_output.put_line(substr(p_message, 1, 255));
    g_arr(g_arr.count + 1) := p_message;
  END;

  ------------------------------------
  -- is_calculate_allowed
  ------------------------------------
  FUNCTION is_submit_allowed(p_incident_id NUMBER) RETURN VARCHAR2 IS
    l_foc_type  VARCHAR2(10);
    l_foc_value NUMBER;
  
    l_contract_line_id   NUMBER;
    l_contract_header_id NUMBER;
    l_from_date          DATE;
    l_to_date            DATE;
    l_inventory_id       NUMBER;
    l_org_id             NUMBER;
  
    l_source     VARCHAR2(50);
    l_identifier VARCHAR2(100);
  BEGIN
    xxoks_cover.get_contract_info4incident(p_incident_id        => p_incident_id,
                                           p_contract_header_id => l_contract_header_id,
                                           p_contract_line_id   => l_contract_line_id,
                                           p_from_date          => l_from_date,
                                           p_to_date            => l_to_date,
                                           p_inventory_id       => l_inventory_id,
                                           p_org_id             => l_org_id);
    -- sp
    l_source     := get_cover_param_text(p_org_id            => l_org_id,
                                         p_item_id           => l_inventory_id,
                                         p_platform_code     => 'SPARE PARTS',
                                         p_platform_sub_code => 'SOURCE');
    l_identifier := get_cover_param_text(p_org_id            => l_org_id,
                                         p_item_id           => l_inventory_id,
                                         p_platform_code     => 'SPARE PARTS',
                                         p_platform_sub_code => 'IDENTIFIER');
  
    IF l_source = 'SR' AND l_identifier IS NOT NULL THEN
    
      IF l_contract_line_id IS NOT NULL THEN
        FOR i IN c_sp_lines(p_incident_id, l_from_date, l_to_date) LOOP
        
          RETURN 'FALSE';
        
        END LOOP;
      END IF;
    
    END IF;
  
    -- tm
    IF is_tm(p_incident_id) = 'Y' THEN
      FOR i IN c_tm_lines(p_incident_id) LOOP
      
        RETURN 'FALSE';
      
      END LOOP;
    END IF;
    get_foc_definition(p_incident_id, l_foc_type, l_foc_value);
  
    IF l_foc_value IS NOT NULL THEN
      FOR i IN c_foc_lines(p_incident_id, l_from_date, l_to_date) LOOP
      
        RETURN 'FALSE';
      
      END LOOP;
    END IF;
    RETURN 'TRUE';
  END;

  ----------------------------------------------
  -- get_incident_value
  -----------------------------------------------

  FUNCTION get_incident_value(p_instance_number VARCHAR2, p_type VARCHAR2)
    RETURN VARCHAR2 IS
  
    CURSOR c IS
      SELECT CASE p_type
               WHEN 'COVERAGE_TYPE_MEANING' THEN
                octt.meaning
               WHEN 'CONTRACT_SERVICE_ID' THEN
                to_char(cleb1.id)
               WHEN 'CONTRACT_ID' THEN
                to_char(okhab.id)
               WHEN 'SERVICE_FLEX_NAME' THEN
                msib.segment1
               WHEN 'CONTRACT_NUMBER' THEN
                okhab.contract_number ||
                decode(okhab.contract_number_modifier, NULL, NULL, '   ') ||
                okhab.contract_number_modifier
             END a
      
        FROM okc_k_lines_b       cleb, --sub line
             okc_k_items         oki,
             okc_k_lines_b       cleb1, -- line
             okc_k_items         oki1,
             okc_k_headers_all_b okhab,
             csi_item_instances  cii,
             oks_k_lines_b       kln,
             okc_k_lines_b       okl, --coverage line
             oks_cov_types_tl    octt, -- coverage Type
             oks_k_lines_b       kln1,
             mtl_system_items_b  msib
       WHERE to_number(oki1.object1_id1) = msib.inventory_item_id
         AND msib.organization_id = 91
         AND okhab.id = cleb.dnz_chr_id
         AND oki.object1_id1 = cii.instance_id
         AND oki.cle_id = cleb.id
         AND cleb1.id = kln.cle_id
         AND kln.coverage_id = okl.id
         AND octt.code = kln1.coverage_type
         AND octt.language = 'US'
         AND kln1.cle_id = okl.id
         AND cleb.sts_code = 'ACTIVE'
         AND oki1.cle_id = cleb1.id
         AND cleb1.chr_id = okhab.id
         AND SYSDATE BETWEEN cleb1.start_date AND cleb1.end_date
         AND cii.instance_number = p_instance_number;
    /*CURSOR c IS
    SELECT CASE p_type
             WHEN 'CONTRACT_SERVICE_ID' THEN
              to_char(cleb1.id)
             WHEN 'CONTRACT_ID' THEN
              to_char(okhab.id)
             WHEN 'SERVICE_FLEX_NAME' THEN
              msib.segment1
             WHEN 'CONTRACT_NUMBER' THEN
              okhab.contract_number ||
              decode(okhab.contract_number_modifier, NULL, NULL, '   ') ||
              okhab.contract_number_modifier
           END a
    
    
      FROM okc_k_lines_b       cleb,
           okc_k_items         oki,
           okc_k_lines_b       cleb1,
           okc_k_items         oki1,
           okc_k_headers_all_b okhab,
           csi_item_instances  cii,
           mtl_system_items_b  msib
     WHERE okhab.id = cleb.dnz_chr_id
       AND oki.object1_id1 = cii.instance_id
       AND oki.cle_id = cleb.id
       AND cleb.sts_code = 'ACTIVE'
       AND oki1.cle_id = cleb1.id
       AND cleb1.chr_id = okhab.id
       AND to_number(oki1.object1_id1) = msib.inventory_item_id
       AND msib.organization_id = 91
       AND SYSDATE BETWEEN cleb1.start_date AND cleb1.end_date
       AND cii.instance_number = p_instance_number
       AND rownum = 1;*/
    l_tmp VARCHAR2(240);
  BEGIN
    OPEN c;
    FETCH c
      INTO l_tmp;
    CLOSE c;
  
    RETURN l_tmp;
  END;
END;
/
